var fe=e=>typeof e,I=(e,n=fe)=>r=>n(r)===e,N=I("number"),O=I("undefined"),T=I("string"),E=e=>e===null,v=e=>e.length===0,R=e=>Object.is(e,-0),h=e=>e>0||e===0&&!R(e),F=(e,...n)=>n.some(r=>r(e)),_=Array.isArray,$=e=>F(e,E,O,N)?"constant":!_(e)||v(e)?void 0:F(e[0],T,O,E)||_(e[0])&&(v(e[0])||T(e[0][0]))?"node":N(e[0])?e.length>1&&e.every(n=>N(n)&&!h(n))?"input":"ref":void 0,U=I("constant",$),J=I("node",$),C=I("ref",$),j=I("input",$),V=(e,n)=>()=>n;var xe=(e,n)=>{for(var r of n){let t=e[r];if(F(t,U,C,j,T))return!1;e=t}return!0},B=(e,n)=>{let r=e[0],t=r<0?e.slice(1):e;return[n.slice(0,r).concat(t),t]},G=(e,n,r)=>{let t=[],o=n.concat([e]);for(var s=1;s<e.length;s++){let a=e[s];if(C(a)){let u=a[0]<0?n.at(a[0]):e,[m,l]=B(a,r);!u||!xe(u,l)?e[s]=void 0:t.push(m)}if(J(a)){let u=r.concat(s);t.push(...G(a,o,u))}}return t},Se=(e,n)=>{let r=[],t=[],o=[],s=[],a=new Set(G(e,[],[]).map(i=>i.join(","))),u=i=>a.has(i.join(",")),m={},l=i=>{var c=m[String(i)];if(c===void 0){c=s.length;let f=[V,[i]];s.push(f),m[String(i)]=c}return[c,0]},d=i=>{var c=t.indexOf(i.join(","));return c===-1&&(c=r.length,r.push(0),t.push(i.join(","))),c},p=(i,c,f)=>{let b=c.concat([i]);for(var x=1;x<i.length;x++){let y=i[x];if(J(y))p(y,b,f.concat(x));else if(U(y))o.push(l(y));else if(j(y))o.push([y[1]]);else if(C(y)){let[de,Ie]=B(y,f);o.push(-d(de))}}o.push([s.length,i.length-1]);let[g,A]=_(i[0])&&!v(i[0])?[i[0][0],i[0].slice(1)]:[i[0],[]],le=T(g)?n[g]:O(g)||E(g)?be(i.length-1):_(g)&&v(g)?ge(i.length-1):()=>{throw new Error("undefined node type "+g)};s.push([le,A]),u(f)&&o.push(d(f))};return p(e,[],[]),[r,o,s]},q=()=>()=>0,k=()=>(e,n)=>n,X=()=>(e,n,r)=>(n+r)/2,H=()=>(e,n,r,t)=>(n+r+t)/3,K=()=>(e,n,r,t,o)=>(n+r+t+o)/4,Q=()=>(e,n,r,t,o,s)=>(n+r+t+o+s)/5,W=()=>(e,...n)=>n.reduce((r,t)=>r+t,0)/n.length,be=e=>[q,k,X,H,K,Q][e]??W,Y=()=>(e,n,r)=>n*r,ee=()=>(e,n,r,t)=>n*r*t,ne=()=>(e,n,r,t,o)=>n*r*t*o,re=()=>(e,n,r,t,o,s)=>n*r*t*o*s,te=()=>(e,...n)=>n.reduce((r,t)=>r*t,1),ge=e=>[q,k,Y,ee,ne,re][e]??te,z="|   ",Ae=(e,n)=>{let[r,t,o]=e;n=Object.assign({__constant:V,__identity_mixer:k,__avgMixer_2:X,__avgMixer_3:H,__avgMixer_4:K,__avgMixer_5:Q,__avgMixer_va:W,__gainMixer_2:Y,__gainMixer_3:ee,__gainMixer_4:ne,__gainMixer_5:re,__gainMixer_va:te},n);let s=d=>{for(var p of Object.keys(n))if(n[p]===d)return p;return d.name||"unknown"},a=o.map(([d,p],i)=>`call ${s(d)}(${p.join(", ")}) [index ${i}]`),u=[];var m=t.length-1;let l=d=>{if(m<0)return;let p=t[m--];if(_(p)){let[c,f]=p,b=h(c)?`${a[c]} with ${f}`:`get input channel ${-c}`;if(u.push(z.repeat(d)+b),h(c))for(var i=0;i<f;i++)l(d+1)}else N(p)&&u.push(`${z.repeat(d)}${h(p)?"store":"get"} register ${p}`)};return l(0),u.join(`
`)+`

`};var Ne=(e,n)=>_(e)?T(e[0])&&e[0]in n?n[e[0]](...e.slice(1)):e.map(r=>Ne(r,n)):e;var D=Math.PI,M=2*D,ye=(e,n,r)=>Math.max(Math.min(e,r),n),S=Math.sin,w=Math.cos,P=Math.sign,L=Math.abs,oe=e=>ye(Math.tan(e),-1,1),se=e=>1-(2*e/M%2+2)%2,ae=e=>1-4*Math.abs(Math.round(e/M)-e/M),ie=e=>S(e**3),ue=e=>S(e**5);var Pe=(e,n=1,r=0,t=0,o=1,s=1,a=1)=>{let u=[],m=e[a];for(var l=1;l<=n;l++){let d=(t??0)+(l>1?-w(D*l)*(l/2|0)*r:0),p=Math.pow(2,d/12);u[l]=e.with(a,N(m)?m*p:[[],m,p]),l>1&&o!==1&&(u[l]=[[],o,u[l]])}return s!==1?[[],s,u]:u},Re=(e,n,r=.9,t=!1,o="d",s=1)=>{let a=[[o,n]];return a[s]=t?[-2,0]:[-2],[,e,[[],r,a]]};var _e=(e,n=1,r,t,o)=>o>0?n<0?t+(r-t)*((o-e)/o)**-n:r+(t-r)*(e/o)**n:t,ce=(e,n)=>{let r=[],t=[],o=[],s=[];for(var a=0,u=0;u<e.length;u+=3){let m=(e[u]??0)*n;r.push(m),t.push(a),o.push(e[u+1]??1),s.push(e[u+2]??0),a+=m}return[r,t,o,s]},Z=(e,n)=>{let[r,t,o,s]=ce(n,e);var a=0;return u=>{if(u>=t.at(-1)+r.at(-1))return 0;for(;u<t[a];)a--;for(;u>t[a]+r[a];)a++;return _e(u-t[a],o[a],s[a-1]??0,s[a],r[a])}},he=(e=0,n=0,r=0,t=1,o=.1,s=0,a=5)=>[...r<0?[,-s,a]:[],e,,1,n,,t,r,,t,o],Je=(e,...n)=>Z(e,he(...n)),je=e=>{let[n,r]=ce(e,1);return r.at(-1)+n.at(-1)};var De=e=>{var n=0;return(r,t,o,s=1,a=0,u=0)=>{let m=(o>3?ie:o>2?oe:o>1?se:o?ae:S)(u*M+(n+=t*M/e*(1+a*ue(r))));return P(m)*L(m)**s}},Le=(e,n=2)=>{var r=0,t=0,o=0,s=0;return(a,u,m)=>{console.log("biquadFilter",u,m);var l=M*L(u)*2/e,d=w(l),p=S(l)/2/n,i=1+p,c=-2*d/i,f=(1-p)/i,b=(1+P(u)*d)/2/i,x=-(P(u)+d)/i,g=b;return s=g*r+x*(r=t)+b*(t=m)-f*o-c*(o=s)}},Ze=()=>{var e=0,n=0;return(r,t=0,o)=>t>0&&(e=(e+1)%(t|0))>=1?n:n=o},ze=(e,n)=>{if(n===0)return(s,a)=>a;let r=e*n|0,t=new Array(r).fill(0);var o=0;return(s,a,u=0)=>{let m=t[o];return t[o]=a+m*u,o=(o+1)%r,m}},Be=e=>{var n=0,r=0;return(t,o,s=.05)=>(n!==o&&(r=o+(Math.random()-.5)*s*o,n=o),r)};function Xe(e){return e=e.replace(/([,\[])([a-z_]+?)([,\]])/ig,'$1"$2"$3').replace(/([,\[])!0([,\]])/g,"$1true$2").replace(/([,\[])!1([,\]])/g,"$1false$2").replace(/\[,/g,"[null,").replace(/,,\]/g,",null]").replace(/,\s*(?=[,\]])/g,",null").replace(/([\[,]-?)(?=\.)/g,"$10").replace(/-\./g,"-0."),JSON.parse(e,(n,r)=>r===null?void 0:r)}var me="____NZ",pe=JSON.stringify,Te=new RegExp(pe(me),"g");function He(e){return pe(e,(n,r)=>N(r)&&R(r)?me:r).replace(/true/g,"!0").replace(/false/g,"!1").replace(/,null\]/g,",,]").replace(/\[null,/g,"[,").replace(/,null(?=[,\]])/g,",").replace(/([\[,]-?)0(?=\.)/g,"$1").replace(/-0\./g,"-.").replace(Te,"-0").replace(/([,\[])"([a-z_]+?)"([,\]])/ig,"$1$2$3")}var Ye=(e,n,r,t=44100)=>{let o=[],[s,a,u]=e,m=u.map(([b,x])=>b(t,...x)),l=r*t,d=n.map(b=>Z(t,b)),p=[],i=[];var c,f;for(f=0;f<l;f++){for(p.length=0,c=0;c<d.length;c++)p.push(d[c](f,...p));for(i.length=0,c=0;c<a.length;c++){let x=a[c];if(N(x))h(x)?s[x]=i.at(-1):i.push(s[-x]);else{let[g,A]=x;h(g)?i.push(m[g](f,...i.splice(i.length-A,A))):i.push(p[-g]??0)}}let b=i.pop();if(!N(b))throw new Error(`got NaN sample at sampleNo=${f}`);o.push(b)}return o},en=(e,n,r=44100)=>{let t=N(e[0])?[e]:e,o=n.createBuffer(t.length,t[0].length,r),s=n.createBufferSource();return t.map((a,u)=>o.getChannelData(u).set(a)),s.buffer=o,s};export{Je as adsrNode,Le as biquadFilter,Ze as bitcrusher,Ye as buildSamples,je as channelDuration,Re as combFilter,Se as compileInstrument,Ae as debugDumpInstrument,ze as delay,Ne as macroexpand,he as makeADSRChannel,Xe as minparse,He as minstringify,Be as shimmerer,Z as standardChannel,en as toBufferNode,Pe as unisons,De as zzfxOscillator};
//# sourceMappingURL=tinya.js.map
