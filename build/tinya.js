var U=(e,n)=>Object.fromEntries(Object.entries(e).map(([t,r])=>[t,n(r,t)])),ve=e=>typeof e,E=(e,n=ve)=>t=>n(t)===e,h=E("number"),g=E("undefined"),y=E("string"),j=e=>e===null,q=e=>e.length===0,T=(e,...n)=>n.some(t=>t(e)),x=Array.isArray,ae=E("object"),ie=e=>T(e,j,g,h)||y(e)&&!(v(e)||I(e)||A(e)),B=e=>T(e,y,h,g,j)?!1:x(e)&&y(e[0])?G(e)?B(X(e)):!0:x(e[0])&&!q(e[0])&&y(e[0][0]),Z=e=>n=>y(n)&&n.startsWith(e),v=Z("@"),I=Z("="),A=Z(">"),G=e=>x(e)&&I(e[0]),ce=e=>G(e)?e[0]:void 0,X=e=>G(e)?e.slice(1):e,V={},ue=e=>(V[e]=(V[e]||0)+1,`${e}${V[e]}`);var me=(e,n)=>{let t=[],r=[],o=a=>{let m=ce(a),c=X(a);for(var p=1;p<c.length;p++){let u=c[p];B(u)?o(u):T(u,I,A,v)?t.push(u):ie(u)&&t.push([u])}t.push([r.length,c.length-1]);let[d,i]=x(c[0])&&!q(c[0])?[c[0][0],c[0].slice(1)]:[c[0],[]],s=y(d)&&n[d]||(()=>{throw new Error("undefined node type "+d)});r.push([s,i]),m!==void 0&&t.push(m)};return o(e),[t,r]},Ae="|   ",Ge=(e,n)=>{let[t,r]=e,o=i=>{for(var s of Object.keys(n))if(n[s]===i)return s;return i.name||"unknown"},a=r.map(([i,s],u)=>`call ${o(i)}(${s.join(", ")}) [index ${u}]`),m=[];var c=t.length-1;let p=(i,s)=>{m.push(`${Ae.repeat(i)}${s}`)},d=i=>{if(c<0)return;let s=t[c--];if(x(s))if(s.length===1)p(i,`push constant ${String(s[0])}`);else{let[b,l]=s;p(i,`${a[b]} with ${l}`);for(var u=0;u<l;u++)d(i+1)}else y(s)&&(v(s)?p(i,`push register ${s.slice(1)}`):A(s)?p(i,`push input channel ${s.slice(1)}`):I(s)&&(p(i,`store register ${s.slice(1)}`),d(i)))};return d(0),m.join(`
`)+`

`};var W=(e,n)=>{var t;return T(e,y,h,g,j)?e:x(e)?y(e[0])&&e[0]in n?T(t=n[e[0]](...e.slice(1)),x,ae)?W(t,n):t:e.map(r=>W(r,n)):U(e,r=>W(r,n))};var Fe=(e,n=1,t=0,r=0,o=1,a=1/n,m=1)=>{let c=["a"],p=e[m];for(var d=1;d<=n;d++){let i=r+t*(2*(d-1)/(n-1||1)-.5),s=Math.pow(2,i/12);c[d]=e.with(m,h(p)?p*s:["g",p,s]),d>1&&o!==1&&(c[d]=["g",o,c[d]])}return a!==1?["g",a,c]:c},$e=(e,n,t=.9,r=!1)=>{let o=ue("=cff_"),a=r?[]:[o],m=r?[o]:[];return[...a,"a",[...m,"a",e],["g",t,["d",n,,"@"+o.slice(1)]]]},Qe={u:Fe,cf:$e};var pe=(e,n)=>{let t=[0],r=[0],o=[0];for(var a=0,m=0;m<e.length;m+=2){let c=(e[m]??0)*n;t.push(c),r.push(a),o.push(e[m+1]??o.at(-1)),a+=Math.abs(c)}return[t,r,o]},Se=(e,n,t,r)=>r<=0?t:n+(t-n)*(e/r),R=(e,n)=>{let[t,r,o]=pe(n,e);var a=0;return m=>{if(m>=r.at(-1)+t.at(-1))return 0;for(;m<r[a];)a--;for(;m>r[a]+t[a];)a++;return Se(m-r[a],o[a-1]??0,o[a],t[a])}},K=(e=0,n=0,t=0,r=1,o=.1)=>[e,1,n,r,t,r,o],He=(e,...n)=>R(e,K(...n)),en=e=>{let[n,t]=pe(e,1);return t.at(-1)+n.at(-1)};var Re=Math.PI,O=2*Re,_e=(e,n,t)=>Math.max(Math.min(e,t),n),_=Math.sin,de=Math.cos,k=Math.sign,L=Math.abs,fe=e=>_e(Math.tan(e),-1,1),le=e=>1-(2*e/O%2+2)%2,ge=e=>1-4*Math.abs(Math.round(e/O)-e/O),be=e=>_(e**3),Ne=e=>_(e**5);var an=(e,n)=>()=>n,Me=()=>(e,...n)=>n.reduce((t,r)=>t+r,0),ye=()=>(e,...n)=>n.reduce((t,r)=>t*r,1),we=e=>{var n=0;return(t,r,o,a=1,m=0,c=0)=>{let p=(o>3?be:o>2?fe:o>1?le:o?ge:_)(c*O+(n+=r*O/e*(1+m*Ne(t))));return k(p)*L(p)**a}},Pe=(e,n=2)=>{var t=0,r=0,o=0,a=0;return(m,c,p)=>{var d=O*L(c)*2/e,i=de(d),s=_(d)/2/n,u=1+s,b=-2*i/u,l=(1-s)/u,N=(1+k(c)*i)/2/u,f=-(k(c)+i)/u,F=N;return a=F*t+f*(t=r)+N*(r=p)-l*o-b*(o=a)}},Ue=()=>{var e=0,n=0;return(t,r=0,o)=>(++e>=r&&(e=0,n=o),n)},Ee=e=>{var n=65536,t=new Float32Array(n),r=0;return(o,a,m=0,c)=>{let p=e*a;if(p>n){var d=n<<1;let u=new Float32Array(n);for(var i=0;i<n;i++)u[i]=t[(r+i)%n];t=u,r=n,n=d}let s=t[(r+n-p|0)%n];return t[r]=c+s*m,r=(r+1)%n,s}},je=e=>{var n=0,t=0;return(r,o,a=.05)=>(n!==o&&(t=o+(Math.random()-.5)*a*o,n=o),t)},ke=e=>{var n=1/0;let t=1/e;return(r,o,a=1)=>(n+=t*a,n>=o?(n=0,1):0)},De=(e,n=0,t=1)=>{var r=n;return(o,a,m=0,c,p,d,i,s)=>{if(r+=a/(t?e:1),!g(p)&&!g(d)){let u=d-p;r<p&&(r+=u),r>d&&(r-=u)}return!g(s)&&r>s&&(r=s),!g(i)&&r<i&&(r=i),m>0&&(r=c??0),r}},xe={g:ye,rm:ye,a:Me,w:we,f:Pe,b:Ue,d:Ee,sh:je,c:ke,i:De,ch:R};function un(e){return e=e.replace(/(?<=[,\[\{}])([=>@]?[a-z_][a-z\d_]*)(?=[,:\]\}])/ig,'"$1"').replace(/([,\[])!0([,\]])/g,"$1true$2").replace(/([,\[])!1([,\]])/g,"$1false$2").replace(/\[,/g,"[null,").replace(/,,\]/g,",null]").replace(/,\s*(?=[,\]])/g,",null").replace(/([\[,]-?)(?=\.)/g,"$10").replace(/-\./g,"-0."),console.log("preprocessed JSON string:",e),JSON.parse(e,(n,t)=>t===null?void 0:t)}function mn(e){return JSON.stringify(e).replace(/true/g,"!0").replace(/false/g,"!1").replace(/,null\]/g,",,]").replace(/\[null,/g,"[,").replace(/,null(?=[,\]])/g,",").replace(/([\[,]-?)0(?=\.)/g,"$1").replace(/-0\./g,"-.").replace(/(?<=[,\[\{])"([=>@]?[a-z_][a-z\d_]*?)"(?=[,:\}])/ig,"$1")}var he=(e,n,t,r=44100)=>{let o=[],[a,m]=e,c={},p=m.map(([N,f])=>N(r,...f)),d=t*r,i=U(n,N=>R(r,N)),s=[];var u={},b,l;for(l=0;l<d;l++){u={};for(b of Object.keys(i))u[b]=i[b](l,u);for(s.length=0,b=0;b<a.length;b++){let f=a[b];if(I(f))c[f.slice(1)]=s.at(-1);else if(v(f))s.push(c[f.slice(1)]??0);else if(A(f))s.push(u[f.slice(1)]??0);else if(f.length===1)s.push(f[0]);else{let[F,$]=f;s.push(p[F](l,...s.splice(s.length-$,$)))}}let N=s.pop();if(!h(N))throw new Error(`got NaN sample at sampleNo=${l}`);o.push(N)}return o},ln=(e,n,t=44100)=>{let r=h(e[0])?[e]:e,o=n.createBuffer(r.length,r[0].length,t),a=n.createBufferSource();return r.map((m,c)=>o.getChannelData(c).set(m)),a.buffer=o,a};var ze=44100,Je=.3,Tn=(e=1,n=.05,t=220,r=0,o=0,a=.1,m=0,c=1,p=0,d=0,i=0,s=0,u=0,b=0,l=0,N=0,f=0,F=1,$=0,D=0,Q=0)=>{e*=Je,p*=500,d*=500,N*=100;let Y=r+$+o+a,Te=Y+f;var M,w;let H=()=>w?(w[0]!="=rc"&&w.unshift("=rc"),"@rc"):w=["c",u];if(i){var P;if(u){for(var z=u;z<s;)z+=u;P=[["i",,0],["g",i,["c",z]]]}else P=i;s?M=["d",s,,P]:M=P}var S;if(p||d){var C;d?C=[["i",p],d]:C=p,S=["i",C],u&&(S[2]=H(),S[3]=0,x(C)&&(C[2]=H(),C[3]=p))}let ee=["sh",t,n],ne=!g(M)||!g(S)?["a",ee,M,S].filter(J=>!g(J)):ee,Ie=["w",l!==0?["g",ne,["w",l,,,,.25]]:ne,m,c,b],Oe=u>0&&D>0?["a",1-D,["g",D,["w",1/u,,,,.5]]]:void 0,Ce=[["ch",K(r,$,o,F,a)]],re=["g",Ie,Oe,Ce].filter(J=>!g(J)),te=f>0?["a",["g",.5,re],["g",["d",f,,"@di"],.5,[["ch",[0,1,Y,1,f]]]]]:re,oe=Q?["f",Q,te]:te,se=N?["b",N,oe]:oe;return f>0&&se.unshift("=di"),he(me(["g",e,se],xe),{},Te,ze)};export{ze as ZZFX_SAMPLE_RATE,He as adsrNode,Pe as biquadFilter,Ue as bitcrusher,he as buildSamples,Qe as builtinMacros,xe as builtinNodes,en as channelDuration,ke as clock,$e as combFilter,me as compileInstrument,an as constant,Ge as debugDumpInstrument,Ee as delay,ye as gainMixer,De as integrator,W as macroexpand,K as makeADSRChannel,un as minparse,mn as minstringify,je as shimmerer,R as standardChannel,Me as summingMixer,ln as toBufferNode,Fe as unisons,we as zzfxOscillator,Tn as zzfxSamples};
//# sourceMappingURL=tinya.js.map
